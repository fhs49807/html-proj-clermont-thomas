<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Financial | Chart.js</title>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.1/dist/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
    <script src="https://www.chartjs.org/chartjs-chart-financial/chartjs-chart-financial.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    
    <div style="width:1000px">
        <canvas id="stockChart"></canvas>
    </div>

<!-- ------------------------------------------------------------------ -->

    <script>
        var barCount = 60;
        var initialDateStr = '01 Apr 2017 00:00 Z';

        var ctx = document.getElementById('stockChart').getContext('2d');
        ctx.canvas.width = 800;
        ctx.canvas.height = 400;

        var barData = getRandomData(initialDateStr, barCount);
        function lineData() { return barData.map(d => { return { x: d.x, y: d.c } }) };

        var stockChart = new Chart(ctx, {
            type: 'candlestick',
            data: {
                datasets: [{
                    label: 'CHRT - a random curve',
                    data: barData
                }]
            }
        });

        var getRandomInt = function (max) {
            return Math.floor(Math.random() * Math.floor(max));
        };

        function randomNumber(min, max) {
            return Math.random() * (max - min) + min;
        }

        function randomBar(date, lastClose) {
            var open = +randomNumber(lastClose * 0.95, lastClose * 1.05).toFixed(2);
            var close = +randomNumber(open * 0.95, open * 1.05).toFixed(2);
            var high = +randomNumber(Math.max(open, close), Math.max(open, close) * 1.1).toFixed(2);
            var low = +randomNumber(Math.min(open, close) * 0.9, Math.min(open, close)).toFixed(2);
            return {
                x: date.valueOf(),
                o: open,
                h: high,
                l: low,
                c: close
            };

        }

        function getRandomData(dateStr, count) {
            var date = luxon.DateTime.fromRFC2822(dateStr);
            var data = [randomBar(date, 30)];
            while (data.length < count) {
                date = date.plus({ days: 1 });
                if (date.weekday <= 5) {
                    data.push(randomBar(date, data[data.length - 1].c));
                }
            }
            return data;
        }

        var update = function () {
            var dataset = stockChart.config.data.datasets[0];

            // put datas in stockChart
            // mixed stockCharts
            var mixed = document.getElementById('mixed').value;
            if (mixed === 'true') {
                stockChart.config.data.datasets = [
                    {
                        label: 'CHRT - a random curve',
                        data: barData
                    },
                    {
                        label: 'Close price',
                        type: 'line',
                        data: lineData()
                    }
                ]
            }
            // not mixed stockCharts
            else {
                stockChart.config.data.datasets = [
                    {
                        label: 'CHRT - a random curve',
                        data: barData
                    }
                ]
            }

            stockChart.update();
        };

        
        </script>

<!-- ----------------------------------------------------------------- -->

</body>

</html>